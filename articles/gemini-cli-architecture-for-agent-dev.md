---
title: "Gemini CLIã¯ã©ã®ã‚ˆã†ã«MCPãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã‹ï¼Ÿå®Ÿè£…èª¿æŸ»ãƒ¡ãƒ¢"
emoji: "ğŸ› ï¸"
type: "tech"
topics: ["Gemini", "CLI", "LLM", "MCP", "Agent"]
published: true
published_at: 2025-07-17 11:00
---

## ã¯ã˜ã‚ã«

ç¾åœ¨é–‹ç™ºä¸­ã®AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã€å¤–éƒ¨ãƒ„ãƒ¼ãƒ«é€£æºã®ä»•çµ„ã¿ã¨ã—ã¦MCP (Model Context Protocol) ã‚’å°å…¥ã—ã¦ã„ã¾ã™ã€‚ãŸã ã€ç‰¹å®šã®MCPã‚µãƒ¼ãƒãƒ¼ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å€‹ã€…ã«å®Ÿè£…ã—ã¦ã„ã‚‹ã‚ˆã†ãªå½¢ã§æŸ”è»Ÿæ€§ãŒãªãã€åˆ©ç”¨è€…ãŒä½¿ç”¨ã™ã‚‹MCPã‚’è‡ªç”±ã«è¨­å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ãã®ãŸã‚ã®å‚è€ƒã¨ã—ã¦ã€Googleè£½ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ„ãƒ¼ãƒ«ã€ŒGemini CLIã€ãŒã©ã®ã‚ˆã†ã«MCPã‚’æ‰±ã£ã¦ã„ã‚‹ã‹ã‚’èª¿æŸ»ã—ã¾ã—ãŸã€‚

æœ¬è¨˜äº‹ã¯ã€ãã®éš›ã®èª¿æŸ»çµæœã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚Gemini CLIã®å†…éƒ¨å®Ÿè£…ï¼ˆTypeScriptï¼‰ã‚’è¿½ã„ãªãŒã‚‰ã€MCPã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šã‹ã‚‰ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œã¾ã§ã®å…·ä½“çš„ãªæµã‚Œã‚’ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚

ã“ã®è¨˜äº‹ã®æƒ³å®šèª­è€…ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ–¹ã€…ã§ã™ã€‚

- MCPå¯¾å¿œã®AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è‡ªä½œã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹é–‹ç™ºè€…
- MCP (Model Context Protocol) ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«èˆˆå‘³ãŒã‚ã‚‹æ–¹

:::message
ã“ã®è¨˜äº‹ã¯ã€ç­†è€…ãŒGemini CLIã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª¿æŸ»ã—ãŸéš›ã®å€‹äººçš„ãªãƒ¡ãƒ¢ã‚’å…ƒã«æ§‹æˆã—ãŸã‚‚ã®ã§ã€æ–‡ç« ã‚‚å¤§éƒ¨åˆ†ã‚’Gemini CLIãŒè¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚å†…å®¹ã®æ­£ç¢ºæ€§ã«ã¯æ³¨æ„ã‚’æ‰•ã£ã¦ã„ã¾ã™ãŒã€æ­£ç¢ºã§ãªã„æƒ…å ±ãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã‚ˆã‚Šæ­£ç¢ºã‹ã¤æœ€æ–°ã®æƒ…å ±ã¯ã€è¨˜äº‹æœ«å°¾ã®å‚è€ƒãƒªãƒ³ã‚¯ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
èª¿æŸ»ã¨æ–‡ç« åŒ–ã®ãƒ—ãƒ­ã‚»ã‚¹:

1. Gemini CLIã«ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚„docsã‚’èª­ã¾ã›ã‚‹
2. ã¾ã¨ã‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ã‚‚ã‚‰ã„ã€é©å®œã“ã¡ã‚‰ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„å®Ÿè£…ã‚’ç¢ºèª
3. æ¦‚å¿µã‚„ä»•çµ„ã¿ã§ç†è§£ãŒè¿½ã„ä»˜ã‹ãªã„éƒ¨åˆ†ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„å¹³æ˜“ãªè¨˜äº‹ãªã©ã‚’ã¾ã¨ã‚ã¦ã‚‚ã‚‰ã£ã¦ç¢ºèª
4. æœ€çµ‚çš„ã«ã¾ã¨ã‚ãŸè³‡æ–™ã‹ã‚‰æ–‡ç« ã‚’ç”Ÿæˆã—ã€æ‰‹ç›´ã—

:::

## MCP (Model Context Protocol) ã¨ã¯

èª¿æŸ»ã«å…ˆç«‹ã£ã¦ã€å‰æã¨ãªã‚‹MCPã«ã¤ã„ã¦Anthropicã®å…¬å¼æƒ…å ±ãªã©ã‚’å…ƒã«æ•´ç†ã—ã¾ã™ã€‚

MCPã¯ã€AIãƒ¢ãƒ‡ãƒ«ã‚„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã¨ã€å¤–éƒ¨ã®ãƒ„ãƒ¼ãƒ«ã‚„ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ï¼ˆã‚µãƒ¼ãƒãƒ¼ï¼‰ã¨ã‚’å®‰å…¨ã«æ¥ç¶šã™ã‚‹ãŸã‚ã®ã‚ªãƒ¼ãƒ—ãƒ³ãªæ¨™æº–ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™ã€‚å¾“æ¥ã€AIãŒå¤–éƒ¨APIã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯å€‹åˆ¥ã®é€£æºå®Ÿè£…ãŒå¿…è¦ã§ã—ãŸãŒã€MCPã¨ã„ã†å…±é€šè¦æ ¼ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€ãã®æ‰‹é–“ã‚’å¤§å¹…ã«å‰Šæ¸›ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚

ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ/ã‚µãƒ¼ãƒãƒ¼ãƒ¢ãƒ‡ãƒ«ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚

- **MCPã‚µãƒ¼ãƒãƒ¼**: ç‰¹å®šã®æ©Ÿèƒ½ï¼ˆä¾‹: ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã€DBæ¤œç´¢ã€Web APIé€£æºï¼‰ã‚’æä¾›ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€‚MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã«è¨­å®šã‚’è¨˜è¿°ã—ã€`npx` ã‚„ `uvx` ã¨ã„ã£ãŸã‚³ãƒãƒ³ãƒ‰ã§ãƒ­ãƒ¼ã‚«ãƒ«ã«èµ·å‹•ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã¯ã€ã“ã¡ã‚‰ã«è©²å½“ã—ã¾ã™ã€‚
- **MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**: MCPã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã—ã€ãã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹å´ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€‚Gemini CLIã‚„ã€ç§ãŸã¡ãŒé–‹ç™ºã™ã‚‹AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã“ã‚Œã«ã‚ãŸã‚Šã¾ã™ã€‚

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã‚µãƒ¼ãƒãƒ¼ã«ã€Œã©ã‚“ãªãƒ„ãƒ¼ãƒ«ãŒä½¿ãˆã‚‹ã‹ï¼Ÿã€ã‚’å•ã„åˆã‚ã›ã€ã‚µãƒ¼ãƒãƒ¼ã¯ãã®å®šç¾©ã‚’è¿”ã—ã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆã¨ã€ãã®å†…éƒ¨ã®LLMï¼‰ã¯ã€ãã®å®šç¾©ã‚’è¦‹ã¦ãƒ„ãƒ¼ãƒ«ã‚’é¸æŠã—ã€ã‚µãƒ¼ãƒãƒ¼ã«å®Ÿè¡Œã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¾ã™ã€‚

### å…¨ä½“åƒã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

ã“ã“ã¾ã§ã®ç™»å ´äººç‰©ã¨ã‚„ã‚Šå–ã‚Šã®æµã‚Œã‚’ã€ç°¡å˜ãªå›³ã«ã¾ã¨ã‚ã¾ã™ã€‚

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant Client as Gemini CLI (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ)
    participant LLM as Google Gemini (LLM)
    participant Server as MCPã‚µãƒ¼ãƒãƒ¼
    participant API as å¤–éƒ¨API (GitHubç­‰)

    User->>+Client: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›
    Client->>+LLM: 1. ãƒ„ãƒ¼ãƒ«å®šç¾©(FunctionDeclaration)ã‚’æç¤º
    LLM-->>-Client: 2. ãƒ„ãƒ¼ãƒ«å®Ÿè¡ŒæŒ‡ç¤º(FunctionCall)ã‚’è¿”ã™
    Client->>+Server: 3. MCPå½¢å¼ã§ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    Server->>+API: 4. å¤–éƒ¨APIã‚’å‘¼ã³å‡ºã—
    API-->>-Server: å®Ÿè¡Œçµæœã‚’è¿”ã™
    Server-->>-Client: 5. MCPå½¢å¼ã§çµæœã‚’è¿”ã™
    Client->>+LLM: 6. ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œçµæœã‚’æç¤º
    LLM-->>-Client: 7. æœ€çµ‚çš„ãªå¿œç­”ã‚’ç”Ÿæˆ
    Client->>-User: å¿œç­”ã‚’å‡ºåŠ›
```

## Gemini CLIã«ãŠã‘ã‚‹MCPãƒ„ãƒ¼ãƒ«åˆ©ç”¨ã®ãƒ•ãƒ­ãƒ¼

Gemini CLIã®ã‚³ãƒ¼ãƒ‰ã‚’èª¿æŸ»ã—ãŸçµæœã€MCPãƒ„ãƒ¼ãƒ«ã®åˆ©ç”¨ã¯å¤§ããåˆ†ã‘ã¦ä»¥ä¸‹ã®æµã‚Œã§å‡¦ç†ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

1. **MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®èµ·å‹•ã¨ãƒ„ãƒ¼ãƒ«ã®ç™ºè¦‹**
2. **ç™ºè¦‹ã—ãŸãƒ„ãƒ¼ãƒ«ã®å†…éƒ¨ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ã®ç™»éŒ²**
3. **LLMã¸ã®ãƒ„ãƒ¼ãƒ«æƒ…å ±æç¤ºã¨é¸æŠä¾é ¼**
4. **LLMã®é¸æŠã«åŸºã¥ããƒ„ãƒ¼ãƒ«å®Ÿè¡Œ**

ä»¥ä¸‹ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚³ãƒ¼ãƒ‰ã¨å…±ã«è¦‹ã¦ã„ãã¾ã™ã€‚

### 1. MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®èµ·å‹•ã¨ãƒ„ãƒ¼ãƒ«ã®ç™ºè¦‹ãƒ»ç™»éŒ²

ã“ã®å‡¦ç†ã¯ã€ä¸»ã« `packages/core/src/tools/mcp-client.ts` ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

Gemini CLIï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã¯èµ·å‹•æ™‚ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š (`settings.json`) ã«åŸºã¥ã„ã¦ `connectAndDiscover` é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚ã“ã®é–¢æ•°ãŒã€è¨­å®šã•ã‚ŒãŸå„MCPã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šã€ãƒ„ãƒ¼ãƒ«ã®ç™ºè¦‹ã€ãã—ã¦å†…éƒ¨ã®ãƒ„ãƒ¼ãƒ«ç®¡ç†æ©Ÿæ§‹ï¼ˆ`ToolRegistry`ï¼‰ã¸ã®ç™»éŒ²ã¾ã§ã‚’ä¸€è²«ã—ã¦è¡Œã„ã¾ã™ã€‚

:::details packages/core/src/tools/mcp-client.ts

```typescript:packages/core/src/tools/mcp-client.ts
// ... (ä¸€éƒ¨æŠœç²‹)
export async function connectAndDiscover(
  mcpServerName: string,
  mcpServerConfig: MCPServerConfig,
  toolRegistry: ToolRegistry,
  debugMode: boolean,
): Promise<void> {
  // ... (æ¥ç¶šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ãªã©)

  try {
    // MCPã‚µãƒ¼ãƒãƒ¼ã¸æ¥ç¶š
    const mcpClient = await connectToMcpServer(
      mcpServerName,
      mcpServerConfig,
      debugMode,
    );
    try {
      // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ„ãƒ¼ãƒ«æƒ…å ±ã‚’å–å¾—
      const tools = await discoverTools(
        mcpServerName,
        mcpServerConfig,
        mcpClient,
      );
      // å–å¾—ã—ãŸãƒ„ãƒ¼ãƒ«ã‚’ToolRegistryã«ç™»éŒ²
      for (const tool of tools) {
        toolRegistry.registerTool(tool);
      }
    } catch (error) {
      mcpClient.close();
      throw error;
    }
  } catch (error) {
    // ... (ã‚¨ãƒ©ãƒ¼å‡¦ç†)
  }
}

export async function discoverTools(
  mcpServerName: string,
  mcpServerConfig: MCPServerConfig,
  mcpClient: Client,
): Promise<DiscoveredMCPTool[]> {
  try {
    // @modelcontextprotocol/sdk ã‚’åˆ©ç”¨ã—ã¦ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’å–å¾—
    const mcpCallableTool = mcpToTool(mcpClient);
    const tool = await mcpCallableTool.tool();

    if (!Array.isArray(tool.functionDeclarations)) {
      throw new Error(`Server did not return valid function declarations.`);
    }

    const discoveredTools: DiscoveredMCPTool[] = [];
    for (const funcDecl of tool.functionDeclarations) {
      // ... (åå‰ã®è¡çªå›é¿ã‚„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚ºå‡¦ç†)

      // å†…éƒ¨è¡¨ç¾ã§ã‚ã‚‹ DiscoveredMCPTool ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
      discoveredTools.push(
        new DiscoveredMCPTool(/* ... */)
      );
    }
    return discoveredTools;
  } catch (error) {
    throw new Error(`Error discovering tools: ${error}`);
  }
}
```

:::

`discoverTools` é–¢æ•°å†…ã§ã€`mcpToTool(mcpClient).tool()` ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§ã€MCPã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ„ãƒ¼ãƒ«ã®ä»•æ§˜ï¼ˆ`FunctionDeclaration` ã®é…åˆ—ï¼‰ã‚’å–å¾—ã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚å–å¾—ã•ã‚ŒãŸæƒ…å ±ã¯ã€å¾Œç¶šã®å‡¦ç†ã§æ‰±ã„ã‚„ã™ã„ã‚ˆã†ã€Gemini CLIå†…éƒ¨ã® `DiscoveredMCPTool` ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¤‰æ›ã•ã‚ŒãŸä¸Šã§ `ToolRegistry` ã«ç™»éŒ²ã•ã‚Œã¾ã™ã€‚

### 2. LLMã¸ã®ãƒ„ãƒ¼ãƒ«æƒ…å ±æç¤ºã¨é¸æŠä¾é ¼

ãƒ„ãƒ¼ãƒ«ãŒ `ToolRegistry` ã«ç™»éŒ²ã•ã‚ŒãŸå¾Œã€ãã®æƒ…å ±ãŒã©ã®ã‚ˆã†ã«LLMã«æ¸¡ã•ã‚Œã‚‹ã®ã‹ã€‚ã“ã®éƒ¨åˆ†ã¯ `packages/core/src/core/client.ts` ã® `startChat` ãƒ¡ã‚½ãƒƒãƒ‰ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

å¯¾è©±ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹éš›ã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ `ToolRegistry` ã‹ã‚‰ç¾åœ¨åˆ©ç”¨å¯èƒ½ãªã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«ã®ä»•æ§˜ã€ã™ãªã‚ã¡ `FunctionDeclaration` ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚`FunctionDeclaration` ã¯ã€Googleã®Generative AI SDKã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã€ä»¥ä¸‹ã®ä¸»è¦ãªæƒ…å ±ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚

- **`name`**: ãƒ„ãƒ¼ãƒ«ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªåå‰ã€‚
- **`description`**: ãƒ„ãƒ¼ãƒ«ãŒä½•ã‚’ã™ã‚‹ã®ã‹ã‚’è‡ªç„¶è¨€èªã§èª¬æ˜ã—ãŸæ–‡ç« ã€‚LLMãŒãƒ„ãƒ¼ãƒ«ã‚’é¸æŠã™ã‚‹ä¸Šã§æœ€ã‚‚é‡è¦ãªæƒ…å ±ã¨ãªã‚Šã¾ã™ã€‚
- **`parameters`**: ãƒ„ãƒ¼ãƒ«ãŒå¿…è¦ã¨ã™ã‚‹å¼•æ•°ã®ã‚¹ã‚­ãƒ¼ãƒï¼ˆå‹ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€å¿…é ˆã‹ã©ã†ã‹ãªã©ï¼‰ã€‚

Gemini CLIã¯ã€å–å¾—ã—ãŸ `FunctionDeclaration` ã®ãƒªã‚¹ãƒˆã‚’ `tools` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦æ•´å½¢ã—ã€LLMã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã‚ã¾ã™ã€‚

:::details packages/core/src/core/client.ts

```typescript:packages/core/src/core/client.ts
// ... (ä¸€éƒ¨æŠœç²‹)
export class GeminiClient {
  private async startChat(extraHistory?: Content[]): Promise<GeminiChat> {
    // ...

    // ToolRegistryã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—
    const toolRegistry = await this.config.getToolRegistry();
    // Registryã‹ã‚‰å…¨ãƒ„ãƒ¼ãƒ«ã®FunctionDeclarationã‚’å–å¾—
    const toolDeclarations = toolRegistry.getFunctionDeclarations();
    
    // Gemini APIãŒè¦æ±‚ã™ã‚‹å½¢å¼ (Tool[]) ã«æ•´å½¢
    const tools: Tool[] = [{ functionDeclarations: toolDeclarations }];
    
    // ...

    try {
      // GeminiChatã®åˆæœŸåŒ–ã€‚ã“ã®ä¸­ã§ãƒ„ãƒ¼ãƒ«å®šç¾©ãŒLLMã«æ¸¡ã•ã‚Œã‚‹
      return new GeminiChat(
        this.config,
        this.getContentGenerator(),
        {
          // ... (ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãªã©ã®è¨­å®š)
          tools, // <--- ã“ã“ã§æ•´å½¢ã—ãŸãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’æ¸¡ã™
        },
        history,
      );
    } catch (error) {
      // ... (ã‚¨ãƒ©ãƒ¼å‡¦ç†)
    }
  }
}
```

:::

LLMã¯ã€ã“ã® `tools` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ¸¡ã•ã‚ŒãŸæƒ…å ±ï¼ˆç‰¹ã«ãƒ„ãƒ¼ãƒ«ã® `description`ï¼‰ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è§£é‡ˆã—ã€ã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã¹ãã‹ã‚’åˆ¤æ–­ã—ã¾ã™ã€‚ãã—ã¦ã€ä½¿ç”¨ã™ã¹ããƒ„ãƒ¼ãƒ«ã¨ãã®å¼•æ•°ã‚’ `FunctionCall` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦è¿”å´ã—ã¾ã™ã€‚

ã“ã®ä»•çµ„ã¿ã«ã‚ˆã‚Šã€CLIã¯LLMã«ãƒ„ãƒ¼ãƒ«ã®é¸æŠã‚’å§”ä»»ã—ã¦ã„ã¾ã™ã€‚

### 3. LLMã®é¸æŠã«åŸºã¥ããƒ„ãƒ¼ãƒ«å®Ÿè¡Œã¨çµæœã®å‡¦ç†

LLMãŒ `FunctionCall` ã‚’è¿”å´ã™ã‚‹ã¨ã€ã„ã‚ˆã„ã‚ˆãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡Œãƒ•ã‚§ãƒ¼ã‚ºã«ç§»ã‚Šã¾ã™ã€‚ã“ã“ã‹ã‚‰ã®å‡¦ç†ã¯ã€å˜ã«MCPã‚µãƒ¼ãƒãƒ¼ã‚’å‘¼ã³å‡ºã™ã ã‘ã§ãªãã€ãã®çµæœã‚’å†ã³LLMã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã™ã‚‹ã¾ã§ã®ä¸€é€£ã®æµã‚Œã«ãªã£ã¦ã„ã¾ã™ã€‚

1. **`FunctionCall` ã®è§£æ**: Gemini CLIã®ã‚³ã‚¢éƒ¨åˆ†ã¯ã€LLMã‹ã‚‰è¿”ã•ã‚ŒãŸ `FunctionCall` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆå‘¼ã³å‡ºã™ã¹ããƒ„ãƒ¼ãƒ«åã¨å¼•æ•°ã‚’å«ã‚€ï¼‰ã‚’è§£æã—ã¾ã™ã€‚

2. **ãƒ„ãƒ¼ãƒ«ã®æ¤œç´¢ã¨å®Ÿè¡Œ**: CLIã¯ã€ãƒ„ãƒ¼ãƒ«åã‚’ä½¿ã£ã¦ `ToolRegistry` ã‹ã‚‰å¯¾å¿œã™ã‚‹ `DiscoveredMCPTool` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¤œç´¢ã—ã€ãã® `execute` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

3. **MCPã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: `execute` ãƒ¡ã‚½ãƒƒãƒ‰ã®å†…éƒ¨ã§ã€LLMã‹ã‚‰å—ã‘å–ã£ãŸå¼•æ•°ã‚’å…ƒã«ã€ä»Šåº¦ã¯CLIå†…éƒ¨ã§MCPã‚µãƒ¼ãƒãƒ¼ã¸é€ã‚‹ãŸã‚ã®æ–°ãŸãª `FunctionCall` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä½œæˆã•ã‚Œã¾ã™ã€‚ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒ `@modelcontextprotocol/sdk` ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é€šã˜ã¦ã€å¯¾è±¡ã®MCPã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã™ã€‚

4. **çµæœã®å—ã‘å–ã‚Šã¨æ•´å½¢**: ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œã—ãŸMCPã‚µãƒ¼ãƒãƒ¼ã¯ã€ãã®çµæœã‚’è¿”ã—ã¾ã™ã€‚`DiscoveredMCPTool` ã¯ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®çµæœã‚’å—ã‘å–ã‚‹ã¨ã€ãã‚Œã‚’æ¬¡ã®2ã¤ã®æƒ…å ±ã«æ•´å½¢ã—ã¦CLIã®ã‚³ã‚¢ã«è¿”å´ã—ã¾ã™ã€‚
    - **`llmContent`**: LLMãŒæ¬¡ã®å¿œç­”ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«å¿…è¦ãªã€ãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡Œçµæœãã®ã‚‚ã®ã€‚
    - **`returnDisplay`**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç”»é¢ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®æƒ…å ±ï¼ˆä¾‹ï¼šã€Œãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿ã¾ã—ãŸã€ï¼‰ã€‚

5. **LLMã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: æœ€å¾Œã«ã€æ•´å½¢ã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡Œçµæœï¼ˆ`llmContent`ï¼‰ãŒå†ã³LLMã«é€ã‚‰ã‚Œã¾ã™ã€‚LLMã¯ã€ãã®å®Ÿè¡Œçµæœã‚’è¸ã¾ãˆã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®æœ€çµ‚çš„ãªå¿œç­”ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä¾‹ï¼šã€Œã”æŒ‡ç¤ºã®é€šã‚Šã€`sample.txt` ã«å†…å®¹ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚ã€ï¼‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ã€Gemini CLIã¯LLMã¨ã®é–“ã§ã€Œãƒ„ãƒ¼ãƒ«ã¯ä½•ã‹ï¼Ÿï¼ˆ`FunctionDeclaration`ï¼‰ã€ã€Œã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã‹ï¼Ÿï¼ˆ`FunctionCall`ï¼‰ã€ã€Œä½¿ã£ãŸçµæœã©ã†ã ã£ãŸã‹ï¼Ÿï¼ˆãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡Œçµæœï¼‰ã€ã¨ã„ã†ä¸€é€£ã®å¯¾è©±ã‚’è¡Œã†ã“ã¨ã§ã€ãƒ„ãƒ¼ãƒ«é€£æºã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

## ã¾ã¨ã‚

Gemini CLIã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰èª¿æŸ»ã‹ã‚‰ã€MCPã‚’åˆ©ç”¨ã—ãŸãƒ„ãƒ¼ãƒ«é€£æºã®å…·ä½“çš„ãªå®Ÿè£…ãƒ•ãƒ­ãƒ¼ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

- **ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ã‚ˆã‚‹ç–çµåˆ**: MCPã¨ã„ã†è¦ç´„ã‚’ä»‹ã™ã“ã¨ã§ã€CLIæœ¬ä½“ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã¨ãƒ„ãƒ¼ãƒ«æä¾›ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆã‚µãƒ¼ãƒãƒ¼ï¼‰ã‚’åˆ†é›¢ã—ã¦ã„ã‚‹ã€‚
- **å‹•çš„ãªãƒ„ãƒ¼ãƒ«ç™»éŒ²**: èµ·å‹•æ™‚ã«è¨­å®šã•ã‚ŒãŸã‚µãƒ¼ãƒãƒ¼ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«ã‚’å‹•çš„ã«å†…éƒ¨ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ç™»éŒ²ã™ã‚‹ã€‚
- **LLMã¸ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæç¤º**: å¯¾è©±ã®éƒ½åº¦ã€ç™»éŒ²æ¸ˆã¿ãƒ„ãƒ¼ãƒ«ã®ä¸€è¦§ã‚’ `FunctionDeclaration` ã¨ã—ã¦LLMã«æ¸¡ã—ã€ãƒ„ãƒ¼ãƒ«ã®é¸æŠã‚’å§”ã­ã‚‹ã€‚

Gemini CLIã®ã‚ˆã†ãªå®Œæˆåº¦ã®é«˜ã„ãƒ„ãƒ¼ãƒ«ã®ä¸­èº«ãŒã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¦ã€ãƒ¢ãƒã¥ãã‚Šã®å‚è€ƒã«ã§ãã‚‹ã®ã¯ã¨ã¦ã‚‚ã‚ã‚ŠãŒãŸã„ã§ã™ã­ã€‚ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãªã©ã‚‚èª­ã‚“ã§å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚
ä»–ã«ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§OpenCodeãªã©ã‚‚ã‚ã‚Šã¾ã™ã—ã€æ¯”è¼ƒã—ã¦ã¿ã‚‹ã®ã‚‚é¢ç™½ãã†ã ãªã¨æ€ã„ã¾ã—ãŸã€‚

ã¾ãŸã€ä»Šå›ã¯ã‚¨ãƒ©ãƒ¼ã‚„ä¾‹å¤–ã®å‡¦ç†ã«ã¤ã„ã¦ã¾ã§ã¯æ‰‹ãŒå›ã‚‰ãªã‹ã£ãŸã®ã§ã€ã“ã¡ã‚‰ã‚‚è¿½ã€…èª¿ã¹ã‚‰ã‚Œã‚Œã°ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

é•·æ–‡ã§ã—ãŸãŒã€æœ€å¾Œã¾ã§ãŠä»˜ãåˆã„ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

## å‚è€ƒãƒªãƒ³ã‚¯

- **Gemini CLI å…¬å¼ã‚µã‚¤ãƒˆ**: [https://gemini.google.com/cli](https://gemini.google.com/cli)
- **Gemini CLI GitHubãƒªãƒã‚¸ãƒˆãƒª**: [https://github.com/google/gemini-cli](https://github.com/google/gemini-cli)
- **Anthropic | Model Context Protocol**: [https://docs.anthropic.com/claude/docs/model-context-protocol](https://docs.anthropic.com/claude/docs/model-context-protocol)
